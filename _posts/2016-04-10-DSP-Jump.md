---
layout: post
title:  "DSP: Jump!"
date:   2016-04-10 21:26:00 +0200
categories: daj-sie-poznac
short_desc: "Tak jak pisaÅ‚em w poprzednim wpisie - musiaÅ‚em zmieniÄ‡ myÅ›lenie o ruchu w grze. Ruch nie moÅ¼e odbywaÄ‡ siÄ™ juÅ¼ â€na zawoÅ‚anieâ€ - musi chodziÄ‡ timer ktÃ³ry bÄ™dzie ogarniaÅ‚ bardziej zaawansowany ruch niÅ¼ proste wciÅ›niÄ™cie przycisku..."
---
Jak to w piosence [Van Halen][van-halen-jump] - skaczemy! ğŸ˜ƒ

Tak jak pisaÅ‚em w [poprzednim wpisie][poprzedni-wpis] - musiaÅ‚em zmieniÄ‡ myÅ›lenie o ruchu w grze. Ruch nie moÅ¼e odbywaÄ‡ siÄ™ juÅ¼ â€na zawoÅ‚anieâ€ - musi chodziÄ‡ timer ktÃ³ry bÄ™dzie ogarniaÅ‚ bardziej zaawansowany ruch niÅ¼ proste wciÅ›niÄ™cie przycisku :arrow_left: czy :arrow_right:.

DodaÅ‚em do aplikacji timer ktÃ³ry tyka sobie co 50 ms. WrzuciÅ‚em tam odpowiedzialnoÅ›Ä‡ za odÅ›wieÅ¼enie widoku.

``` python
def tick(self):
     self.update()
```
I dla ruchu lewo-prawo wszystko Å›miga jak trzeba. Akcja ruchu na graczu siÄ™ wykonuje (czyli w uproszczeniu zmienia siÄ™ jego poÅ‚oÅ¼enie na osi `x`). No ale nie ruszyÅ‚o to tematu skoku ktÃ³ry skÅ‚ada siÄ™ wÅ‚aÅ›ciwie z serii ruchÃ³w (jeÅ›li za ruch uznamy aktualizacjÄ™ pozycji gracza na osiach `x`i `y`).

I tutaj doznaÅ‚em olÅ›nienia! Skoro mam timer ktÃ³ry tyka co jakiÅ› czas to czemu nie zrzuciÄ‡ na niego podejmowania decyzji czy ruch juÅ¼ siÄ™ zakoÅ„czyÅ‚ czy teÅ¼ jeszcze trwa? Znowu dla ruchu lewo-prawo wszystko jest proste - w `self.tick()` trzeba tylko wykonaÄ‡ raz funkcjÄ™ odpowiedzialnÄ… za ruch i tyle, przy skoku zaÅ› mam informacjÄ™ z klasy `Player` mÃ³wiÄ…cÄ… w jakim stanie jest skok uÅ¼ytkownika `player.jump_started`.

Technicznie zaÅ‚atwiÅ‚em to przenoszÄ…c wykonanie funkcji z metody `def keyPressEvent(self, e)` na ustawianie w niej aktualnej akcji. AktualnÄ… akcjÄ™ przechowujÄ™ w zmiennej `self.tick_action` muszÄ™ wiÄ™c tylko przy kaÅ¼dorazowym wciÅ›niÄ™ciu klawisza ustawiaÄ‡ poprawnÄ… funkcjÄ™ do wykonania. W Pythonie jest to proste - wystarczy zapisaÄ‡ do zmiennej metodÄ™ tak, jakby jÄ… siÄ™ wykonywaÅ‚o - z tÄ… rÃ³Å¼nicÄ…, Å¼e **nie dodajemy nawiasÃ³w po nazwie metody**. Powoduje to zapisanie do zmiennej funkcji a nie wykonanie jej - wykonanie realizowane jest wÅ‚aÅ›nie przez nawiasy.

W pewnym uproszczeniu (dla ruchu w lewo) wyglÄ…da to tak:

``` python
def keyPressEvent(self, e):
        key = e.key()

        if key == QtCore.Qt.Key_Left:
            self.tick_action = self.player_move_backward # [1]

def tick(self):
        if self.tick_action is None: # [2]
            return

        self.tick_action() # [3]
        self.update()

        self.tick_action = None # [4]
```

IdÄ…c po numerach dziejÄ… siÄ™ nastÄ™pujÄ…ce rzeczy:
[1] po wykryciu wciÅ›niÄ™cia strzaÅ‚ki w lewo zmienne `tick_action` ustawiana jest na `self.player_move_backward` (ale ta siÄ™ nie wykonuje, bo nie ma nawiasÃ³w)
[2] w metodzie `tick` sprawdzamy czy mamy w ogÃ³le ustawionÄ… jakÄ…Å› metodÄ™
[3] metoda jest wykonywana
[4] akcja ustawiana jest na `None` aby zakoÅ„czyÄ‡ ruch

Å»eby ograÄ‡ skakanie musiaÅ‚em tylko dodaÄ‡ przy [4] sprawdzenie czy player jest w trakcie skoku, takÅ¼e w tej chwili [4] wyglÄ…da tak:
``` python
if self.player.jump_started:
    self.tick_action = self.player_jump
else:
    self.tick_action = None
```

Na teraz to wszystko, w nastÄ™pnym wpisie zajmÄ™ siÄ™ ogarniÄ™ciem wciskania kilku klawiszy jednoczeÅ›nie aby ruch i skok mogÅ‚y odbywaÄ‡ siÄ™ jednoczeÅ›nie. Stay tuned!

Na koniec maÅ‚e demo skoku ğŸ˜ƒ

<img src="/images/jump.gif"/>

[poprzedni-wpis]: http://zelazowy.github.io/daj-sie-poznac/2016/04/05/DSP-Timer.html
[van-halen-jump]: https://www.youtube.com/watch?v=SwYN7mTi6HM
